from __future__ import annotations

from typing import Dict

DEFAULT_LANGUAGE = "en"

_language = DEFAULT_LANGUAGE

_translations: Dict[str, Dict[str, str]] = {
    "en": {
        "app_title": "PDF Toolbox",
        "window_title": "PDF Toolbox",
        "nav_home": "Home",
        "nav_tools": "Tools",
        "menu_help": "Help",
        "menu_about": "About",
        "about_title": "About PDF Toolbox Qt",
        "about_text": (
            "PDF Toolbox Qt\n"
            "Offline PDF toolbox (PySide6 + pikepdf + PyMuPDF + Pillow).\n"
            "Supports merge, split/extract, delete/rotate/reorder, compress, "
            "PDF/image conversion, PPT to PDF, OCR.\n"
            "Free to use.\n"
            "Version: 0.1.0\n"
            "Author: Su Yaoyong\n"
            "Follow for new tools and support."
        ),
        "home_title": "Tools",
        "home_subtitle": "Offline PDF toolbox: pick a tool below to start processing files.",
        "lang_to_zh": "中文",
        "lang_to_en": "English",
        "invalid_params_title": "Invalid Parameters",
        "task_failed_title": "Task Failed",
        "unknown_error": "Unknown error",
        "err_no_input_files": "No input files selected.",
        "err_no_output_dir": "No output folder selected.",
        "err_cancelled": "Task cancelled.",
        "err_page_range": "Invalid page range: {error}",
        "err_pdf_encrypted": "The PDF is encrypted. Please decrypt it or provide the correct password.",
        "err_pdf_corrupt_format": "The PDF may be corrupted or the format is unsupported.",
        "err_pdf_corrupt_read": "The PDF may be corrupted or cannot be read.",
        "err_permission": "Permission denied. Check file permissions or close apps using the file.",
        "err_file_not_found": "File not found or path is invalid.",
        "err_is_directory": "A folder was selected instead of a file.",
        "err_tool_not_found": "Tool not found: {tool_id}",
        "err_file_missing": "File not found: {path}",
        "err_not_file": "Not a file: {path}",
        "err_no_read_perm": "No read permission: {path}",
        "err_output_dir_missing": "Output folder not found: {path}",
        "err_output_not_dir": "Output path is not a folder: {path}",
        "err_no_write_perm": "No write permission: {path}",
        "range_empty": "Page range is empty.",
        "range_invalid": "Invalid range: {token}",
        "range_page_min": "Page number must be >= 1.",
        "range_start_gt_end": "Range start is greater than end: {token}",
        "range_page_out_of_range": "Page out of range: {page} > {max_pages}",
        "err_ocr_need_output": "Please select at least one output format.",
        "err_no_tesseract": (
            "Tesseract OCR not found. Place tesseract\\tesseract.exe in the app folder, "
            "set TESSERACT_CMD, or add it to PATH."
        ),
        "err_no_images_selected": "No images selected.",
        "err_invalid_file_type": "Unsupported file type: {name}",
        "err_missing_office_components": "Office/WPS support components not installed: {error}",
        "err_no_ppt_engine": "No PPT engine detected. Please install PowerPoint or WPS Presentation. ({error})",
        "err_reorder_must_cover_all": "Reorder must cover all pages without duplicates.",
        "browse": "Browse",
        "select_folder": "Select Folder",
        "select_files": "Select Files",
        "select_file": "Select File",
        "header_task": "Task",
        "header_progress": "Progress",
        "header_status": "Status",
        "header_action": "Action",
        "status_waiting": "Waiting",
        "status_cancelled": "Cancelled",
        "status_completed": "Completed",
        "status_failed": "Failed",
        "action_cancel": "Cancel",
        "stage_processing": "Processing",
        "stage_writing": "Writing",
        "progress_reencode_page": "Re-encode page {page}",
        "progress_process_page": "Processing page {page}",
        "progress_export_page": "Export page {page}",
        "progress_merge_file": "Merge: {name}",
        "progress_write_complete": "Write complete",
        "progress_split_page": "Split page {page}",
        "progress_extract_page": "Extract page {page}",
        "progress_reorder_page": "Reorder page {page}",
        "progress_ocr_page": "OCR: {name} page {page}",
        "progress_convert_file": "Converting {name}",
        "progress_complete_file": "Completed {name}",
        "label_input_pdf": "Input PDF",
        "label_input_file": "Input File",
        "label_input_images": "Input Images",
        "label_input_ppt": "Input PPT",
        "label_output_dir": "Output Folder",
        "label_output_name_optional": "Output Name (optional)",
        "label_overwrite": "Overwrite existing files (otherwise auto-rename)",
        "label_preset": "Preset",
        "label_preset_none": "None",
        "label_page_range": "Page Range",
        "placeholder_page_range": "1-3,8,10-12",
        "label_new_order": "New Order",
        "placeholder_new_order": "3,1,2,4-6",
        "label_keep_bookmarks": "Keep bookmarks",
        "label_tip_reorder": "Tip: order must cover all pages without duplicates.",
        "label_basic_compress": "Basic compression",
        "label_image_reencode": "Image re-encode compression",
        "label_linearize": "Linearize (web optimized)",
        "label_recompress": "Recompress streams",
        "label_grayscale": "Grayscale",
        "label_image_compress_options": "Image compression options",
        "label_pdf_to_images_options": "PDF → Images Options",
        "label_page_size": "Page Size",
        "label_language": "Language",
        "label_output_searchable_pdf": "Output searchable PDF",
        "label_output_word": "Output Word",
        "label_dpi": "DPI",
        "panel_merge": "Merge",
        "panel_split_extract": "Split/Extract",
        "panel_delete_rotate": "Delete/Rotate",
        "panel_reorder": "Reorder",
        "panel_compress": "Compress",
        "panel_pdf_to_images": "PDF → Images",
        "panel_images_to_pdf": "Images → PDF",
        "panel_ppt_to_pdf": "PPT → PDF",
        "panel_ocr": "OCR",
        "option_extract_one_pdf": "Extract to single PDF",
        "option_split_many_pdf": "Split into multiple PDFs by page",
        "option_delete_pages": "Delete pages",
        "option_rotate_pages": "Rotate pages",
        "btn_start_merge": "Start Merge",
        "btn_start_split_extract": "Start Split/Extract",
        "btn_start_execute": "Start",
        "btn_start_reorder": "Start Reorder",
        "btn_start_compress": "Start Compression",
        "btn_start_convert": "Start Conversion",
        "btn_start_ocr": "Start OCR",
    },
    "zh": {
        "app_title": "PDF 工具箱",
        "window_title": "PDF 工具箱",
        "nav_home": "返回首页",
        "nav_tools": "功能中心",
        "menu_help": "帮助",
        "menu_about": "关于",
        "about_title": "关于 PDF Toolbox Qt",
        "about_text": (
            "PDF Toolbox Qt\n"
            "离线本地 PDF 工具箱（PySide6 + pikepdf + PyMuPDF + Pillow）。\n"
            "支持合并、拆分/提取、删除/旋转/重排、压缩、PDF/图片互转、PPT 转 PDF、OCR。\n"
            "软件免费使用。\n"
            "版本：0.1.0\n"
            "作者：苏耀勇\n"
            "了解新工具、问题反馈、扫码关注公众号。"
        ),
        "home_title": "功能中心",
        "home_subtitle": "离线本地 PDF 工具箱：选择下方功能开始处理文件。",
        "lang_to_zh": "中文",
        "lang_to_en": "English",
        "invalid_params_title": "参数错误",
        "task_failed_title": "任务失败",
        "unknown_error": "未知错误",
        "err_no_input_files": "未选择输入文件。",
        "err_no_output_dir": "未选择输出目录。",
        "err_cancelled": "任务已取消。",
        "err_page_range": "页码范围错误: {error}",
        "err_pdf_encrypted": "文件已加密，无法处理。请先解密或输入正确密码。",
        "err_pdf_corrupt_format": "PDF 文件可能已损坏或格式不受支持。",
        "err_pdf_corrupt_read": "PDF 文件可能已损坏或无法读取。",
        "err_permission": "权限不足，无法读取或写入文件。请检查权限或关闭占用程序。",
        "err_file_not_found": "文件不存在或路径无效。",
        "err_is_directory": "选择了目录而不是文件。",
        "err_tool_not_found": "未找到工具: {tool_id}",
        "err_file_missing": "文件不存在: {path}",
        "err_not_file": "不是文件: {path}",
        "err_no_read_perm": "无读取权限: {path}",
        "err_output_dir_missing": "输出目录不存在: {path}",
        "err_output_not_dir": "输出路径不是目录: {path}",
        "err_no_write_perm": "无写入权限: {path}",
        "range_empty": "页码范围为空",
        "range_invalid": "无效范围: {token}",
        "range_page_min": "页码必须 >= 1",
        "range_start_gt_end": "范围起始大于结束: {token}",
        "range_page_out_of_range": "页码超出总页数: {page} > {max_pages}",
        "err_ocr_need_output": "请至少选择一种输出格式。",
        "err_no_tesseract": (
            "未检测到 Tesseract OCR。请在应用目录放置 tesseract\\tesseract.exe，"
            "或设置环境变量 TESSERACT_CMD，或配置到 PATH。"
        ),
        "err_no_images_selected": "未选择图片。",
        "err_invalid_file_type": "不支持的文件类型: {name}",
        "err_missing_office_components": "未安装 Office/WPS 支持组件: {error}",
        "err_no_ppt_engine": "未检测到可用的 PPT 引擎，请安装 PowerPoint 或 WPS 演示。({error})",
        "err_reorder_must_cover_all": "重排必须覆盖所有页且不重复。",
        "browse": "浏览",
        "select_folder": "选择目录",
        "select_files": "选择文件",
        "select_file": "选择文件",
        "header_task": "任务",
        "header_progress": "进度",
        "header_status": "状态",
        "header_action": "操作",
        "status_waiting": "等待中",
        "status_cancelled": "已取消",
        "status_completed": "完成",
        "status_failed": "失败",
        "action_cancel": "取消",
        "stage_processing": "处理中",
        "stage_writing": "写入中",
        "progress_reencode_page": "重编码页 {page}",
        "progress_process_page": "处理页 {page}",
        "progress_export_page": "导出页 {page}",
        "progress_merge_file": "合并: {name}",
        "progress_write_complete": "写入完成",
        "progress_split_page": "拆分页 {page}",
        "progress_extract_page": "提取页 {page}",
        "progress_reorder_page": "重排页 {page}",
        "progress_ocr_page": "OCR: {name} 第 {page} 页",
        "progress_convert_file": "转换 {name}",
        "progress_complete_file": "完成 {name}",
        "label_input_pdf": "输入PDF",
        "label_input_file": "输入文件",
        "label_input_images": "输入图片",
        "label_input_ppt": "输入PPT",
        "label_output_dir": "输出目录",
        "label_output_name_optional": "输出名(可选)",
        "label_overwrite": "覆盖已存在文件（否则自动改名）",
        "label_preset": "预设",
        "label_preset_none": "无",
        "label_page_range": "页码范围",
        "placeholder_page_range": "1-3,8,10-12",
        "label_new_order": "新顺序",
        "placeholder_new_order": "3,1,2,4-6",
        "label_keep_bookmarks": "保留书签",
        "label_tip_reorder": "提示: 顺序必须覆盖所有页且不重复",
        "label_basic_compress": "基础压缩",
        "label_image_reencode": "图片重编码压缩",
        "label_linearize": "线性化 (网络优化)",
        "label_recompress": "重压缩流",
        "label_grayscale": "灰度",
        "label_image_compress_options": "图片压缩参数",
        "label_pdf_to_images_options": "PDF → 图片 参数",
        "label_page_size": "页面尺寸",
        "label_language": "语言",
        "label_output_searchable_pdf": "输出可搜索 PDF",
        "label_output_word": "输出 Word",
        "label_dpi": "DPI",
        "panel_merge": "合并",
        "panel_split_extract": "拆分/提取",
        "panel_delete_rotate": "删除/旋转",
        "panel_reorder": "重排",
        "panel_compress": "压缩",
        "panel_pdf_to_images": "PDF → 图片",
        "panel_images_to_pdf": "图片 → PDF",
        "panel_ppt_to_pdf": "PPT → PDF",
        "panel_ocr": "OCR 识别",
        "option_extract_one_pdf": "提取为单个PDF",
        "option_split_many_pdf": "按页拆分多个PDF",
        "option_delete_pages": "删除页",
        "option_rotate_pages": "旋转页",
        "btn_start_merge": "开始合并",
        "btn_start_split_extract": "开始拆分/提取",
        "btn_start_execute": "开始执行",
        "btn_start_reorder": "开始重排",
        "btn_start_compress": "开始压缩",
        "btn_start_convert": "开始转换",
        "btn_start_ocr": "开始识别",
    },
}


def set_language(language: str) -> None:
    global _language
    if language in _translations:
        _language = language


def get_language() -> str:
    return _language


def t(key: str, **kwargs: object) -> str:
    value = _translations.get(_language, {}).get(key, key)
    if kwargs:
        try:
            return value.format(**kwargs)
        except Exception:
            return value
    return value
